<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rifa</title>
</head>

<body>

<h2>Participar en la Rifa</h2>

<input id="nombre" placeholder="Nombre">
<br><br>

<input id="telefono" placeholder="TelÃ©fono">
<br><br>

<button onclick="registrar()">Participar</button>

<br><br>

<h3 id="resultado"></h3>

<!-- âœ… Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>

const firebaseConfig = {
  apiKey: "AIzaSyCqVZwBX96EHfl3k__iqyc7rF1MZmSVpRI",
  authDomain: "rifa-web-2b2f3.firebaseapp.com",
  projectId: "rifa-web-2b2f3",
  storageBucket: "rifa-web-2b2f3.firebasestorage.app",
  messagingSenderId: "440243321091",
  appId: "1:440243321091:web:3a6a0a27e4e418cf6b9136"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();


// âœ… REGISTRO CON NÃšMERO ÃšNICO
async function registrar(){

 let nombre = document.getElementById("nombre").value;
 let telefono = document.getElementById("telefono").value;

 if(nombre === "" || telefono === ""){
   alert("Completa los datos");
   return;
 }

 const ref = db.collection("participantes");

 await db.runTransaction(async (transaction)=>{

   const snapshot = await transaction.get(ref);

   let usados = [];

   snapshot.forEach(doc=>{
     usados.push(doc.data().numero);
   });

   let disponibles=[];

   for(let i=1;i<=100;i++){
     if(!usados.includes(i)){
       disponibles.push(i);
     }
   }

   if(disponibles.length === 0){
     alert("ðŸš« Rifa llena");
     return;
   }

   let numero =
   disponibles[Math.floor(Math.random()*disponibles.length)];

   const nuevoDoc = ref.doc();

   transaction.set(nuevoDoc,{
     nombre:nombre,
     telefono:telefono,
     numero:numero,
     fecha:new Date()
   });

   document.getElementById("resultado")
   .innerText = "âœ… Tu nÃºmero asignado es: #" + numero;

 });

}

</script>

</body>
</html>
