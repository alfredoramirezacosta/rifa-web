<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Rifa</title>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f6f8;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    margin:0;
}

.container{
    background:white;
    padding:25px;
    border-radius:12px;
    width:90%;
    max-width:400px;
    box-shadow:0 5px 15px rgba(0,0,0,0.2);
}

h2{
    text-align:center;
}

input,button{
    width:100%;
    padding:12px;
    margin-top:10px;
    border-radius:8px;
    border:1px solid #ccc;
    font-size:16px;
}

button{
    background:#25D366;
    color:white;
    border:none;
    font-weight:bold;
    cursor:pointer;
}

button:hover{
    background:#1ebe5d;
}

.numero{
    font-size:22px;
    text-align:center;
    margin-top:15px;
    font-weight:bold;
}
</style>
</head>

<body>

<div class="container">

<h2>ðŸŽŸ Participa en la Rifa</h2>

<input type="text" id="nombre" placeholder="Tu nombre">
<input type="tel" id="telefono" placeholder="Tu telÃ©fono">

<button onclick="participar()">Participar</button>

<div class="numero" id="resultado"></div>

</div>


<!-- Firebase -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
getFirestore,
collection,
addDoc,
getDocs
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";


/* ðŸ”¥ TU CONFIG FIREBASE */
const firebaseConfig = {
apiKey: "TU_API_KEY",
authDomain: "TU_DOMINIO",
projectId: "TU_PROJECT_ID",
storageBucket: "TU_BUCKET",
messagingSenderId: "TU_ID",
appId: "TU_APP"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);


/* GENERAR NUMERO UNICO */
async function generarNumeroUnico(){

const snapshot = await getDocs(collection(db,"participantes"));

let usados = [];

snapshot.forEach(doc=>{
usados.push(doc.data().numero);
});

let disponibles=[];

for(let i=1;i<=100;i++){
if(!usados.includes(i)){
disponibles.push(i);
}
}

if(disponibles.length===0){
return null;
}

return disponibles[
Math.floor(Math.random()*disponibles.length)
];
}


/* PARTICIPAR */
window.participar = async function(){

const nombre=document.getElementById("nombre").value.trim();
const telefono=document.getElementById("telefono").value.trim();

if(!nombre || !telefono){
alert("Completa todos los campos");
return;
}

const numero=await generarNumeroUnico();

if(numero===null){
alert("Rifa llena");
return;
}

/* GUARDAR */
await addDoc(collection(db,"participantes"),{
nombre,
telefono,
numero,
fecha:new Date()
});

document.getElementById("resultado").innerHTML=
`âœ… Tu nÃºmero es: ${numero}`;


/* WHATSAPP */
const mensaje=
`Hola, participÃ© en la rifa y mi nÃºmero es ${numero}`;

const whatsapp=
`https://wa.me/526624446775?text=${encodeURIComponent(mensaje)}`;

setTimeout(()=>{
window.location.href=whatsapp;
},1500);

}

</script>

</body>
</html>
