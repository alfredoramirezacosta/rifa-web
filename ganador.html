<!DOCTYPE html>
<html lang="es">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Ganador</title>

<style>

body{
margin:0;
background:#000;
color:white;
font-family:Arial;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
height:100vh;
overflow:hidden;
}

/* CAJA SORTEO */
#slotBox{
width:85vw;
max-width:400px;
height:160px;
border-radius:20px;
background:#111;
display:flex;
justify-content:center;
align-items:center;
font-size:90px;
font-weight:bold;
color:#FFD700;
box-shadow:
0 0 30px orange,
inset 0 0 25px rgba(255,140,0,.6);
}

/* GANADOR */
#resultado{
margin-top:40px;
text-align:center;
opacity:0;
transform:scale(.6);
transition:.6s;
}

.numero{
font-size:65px;
color:gold;
}

.nombre{
font-size:30px;
margin-top:10px;
}

/* CONFETI */
.confeti{
position:fixed;
width:10px;
height:10px;
top:-10px;
animation:caer linear forwards;
}

@keyframes caer{
to{
transform:translateY(110vh) rotate(720deg);
opacity:0;
}
}

</style>
</head>

<body>

<div id="slotBox">üé∞</div>

<div id="resultado"></div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>

const firebaseConfig={
apiKey:"AIzaSyCqVZwBX96EHfl3k__iqyc7rF1MZmSVpRI",
authDomain:"rifa-web-2b2f3.firebaseapp.com",
projectId:"rifa-web-2b2f3"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

let participantes=[];
const box=document.getElementById("slotBox");

/* =========================
   CARGAR PARTICIPANTES
========================= */

db.collection("participantes")
.orderBy("numero")
.get()
.then(snapshot=>{

snapshot.forEach(doc=>{
participantes.push(doc.data());
});

escucharGanador();

});

/* =========================
   ANIMACION SORTEO REALISTA
========================= */

function animarSorteo(ganador){

let velocidad=40;
let tiempoTotal=10000;
let inicio=Date.now();

function loop(){

let transcurrido=
Date.now()-inicio;

let progreso=
transcurrido/tiempoTotal;

/* desaceleraci√≥n */
velocidad=40+(progreso*200);

let random=
participantes[
Math.floor(
Math.random()*participantes.length
)
];

box.innerText=random.numero;

if(transcurrido<tiempoTotal){

setTimeout(loop,velocidad);

}else{

box.innerText=ganador.numero;

setTimeout(()=>{
mostrarGanador(ganador);
confeti();
},600);

}

}

loop();
}

/* =========================
   MOSTRAR GANADOR
========================= */

function mostrarGanador(g){

const r=document.getElementById("resultado");

r.innerHTML=`
üèÜ GANADOR üèÜ
<div class="numero">#${g.numero}</div>
<div class="nombre">${g.nombre}</div>
`;

r.style.opacity=1;
r.style.transform="scale(1)";
}

/* =========================
   CONFETI
========================= */

function confeti(){

for(let i=0;i<150;i++){

let c=document.createElement("div");

c.className="confeti";

c.style.left=Math.random()*100+"vw";
c.style.background=
`hsl(${Math.random()*360},100%,50%)`;

c.style.animationDuration=
(2+Math.random()*3)+"s";

document.body.appendChild(c);

setTimeout(()=>c.remove(),5000);
}
}

/* =========================
   ESCUCHAR GANADOR ADMIN
========================= */

function escucharGanador(){

db.collection("ganador")
.doc("actual")
.onSnapshot(doc=>{

if(!doc.exists())return;

animarSorteo(doc.data());

});

}

</script>

</body>
</html>
