<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ganador</title>

<style>

body{
margin:0;
background:black;
color:white;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
font-family:Arial;
flex-direction:column;
overflow:hidden;
}

#slot{
font-size:90px;
background:#111;
padding:40px 80px;
border-radius:20px;
box-shadow:0 0 40px orange;
}

#resultado{
margin-top:40px;
font-size:40px;
text-align:center;
opacity:0;
transition:.6s;
}

canvas{
position:fixed;
pointer-events:none;
top:0;
left:0;
}

</style>
</head>

<body>

<div id="slot">üé∞</div>

<div id="resultado"></div>

<canvas id="confeti"></canvas>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script type="module">

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import {
getFirestore,
doc,
onSnapshot,
collection,
getDocs
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyCqVZwBX96EHfl3k__iqyc7rF1MZmSVpRI",
authDomain:"rifa-web-2b2f3.firebaseapp.com",
projectId:"rifa-web-2b2f3",
storageBucket:"rifa-web-2b2f3.firebasestorage.app",
messagingSenderId:"440243321091",
appId:"1:440243321091:web:3a6a0a27e4e418cf6b9136"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

const slot=document.getElementById("slot");
const resultado=document.getElementById("resultado");

let ultimoTimestamp=0;


/* üé∞ ANIMACION */
async function animarSorteo(ganador){

const snap=await getDocs(collection(db,"participantes"));

let numeros=[];
snap.forEach(d=>numeros.push(d.data().numero));

let velocidad=50;
let tiempo=0;

resultado.style.opacity=0;

const intervalo=setInterval(()=>{

slot.innerText=
"#"+numeros[
Math.floor(Math.random()*numeros.length)
];

tiempo+=velocidad;
velocidad+=8;

if(tiempo>10000){

clearInterval(intervalo);

slot.innerText="#"+ganador.numero;

resultado.innerHTML=
`üèÜ GANADOR<br>
<b>${ganador.nombre}</b><br>
N√∫mero #${ganador.numero}`;

resultado.style.opacity=1;

/* CONFETI */
confetti({
particleCount:300,
spread:200,
origin:{y:0.6}
});

}

},velocidad);

}


/* ESCUCHAR GANADOR */
onSnapshot(doc(db,"ganador","actual"),docSnap=>{

if(!docSnap.exists()) return;

const data=docSnap.data();

if(data.timestamp===ultimoTimestamp)
return;

ultimoTimestamp=data.timestamp;

animarSorteo(data);

});

</script>

</body>
</html>
