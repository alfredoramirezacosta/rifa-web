<!DOCTYPE html>
<html lang="es">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Ganador</title>

<style>

body{
margin:0;
background:#000;
color:white;
font-family:Arial;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
height:100vh;
text-align:center;
overflow:hidden;
}

/* CAJA PRINCIPAL */
#caja{
background:#111;
padding:50px;
border-radius:25px;
box-shadow:0 0 60px #ff9800;
width:90%;
max-width:500px;
}

/* NUMERO */
#numero{
font-size:90px;
color:#FFD700;
margin:20px 0;
}

/* NOMBRE */
#nombre{
font-size:40px;
}

/* TITULO */
h1{
font-size:35px;
margin:0;
}

</style>

</head>

<body>

<div id="caja">

<h1>ðŸŽ° SORTEO EN CURSO</h1>

<div id="numero">--</div>

<div id="nombre"></div>

</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script type="module">

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import {
getFirestore,
doc,
onSnapshot,
collection,
getDocs
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ðŸ”¥ FIREBASE */
const firebaseConfig={
apiKey:"AIzaSyCqVZwBX96EHfl3k__iqyc7rF1MZmSVpRI",
authDomain:"rifa-web-2b2f3.firebaseapp.com",
projectId:"rifa-web-2b2f3",
storageBucket:"rifa-web-2b2f3.firebasestorage.app",
messagingSenderId:"440243321091",
appId:"1:440243321091:web:3a6a0a27e4e418cf6b9136"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

const numero=document.getElementById("numero");
const nombre=document.getElementById("nombre");

let animando=false;


/* ðŸŽ° ANIMACION */
async function animar(ganador){

if(animando) return;
animando=true;

nombre.innerText="";

const snap=await getDocs(collection(db,"participantes"));

let numeros=[];
snap.forEach(d=>{
numeros.push(d.data().numero);
});

let velocidad=40;
let vueltas=0;

const loop=setInterval(()=>{

numero.innerText =
numeros[Math.floor(Math.random()*numeros.length)];

vueltas++;
velocidad+=6;

if(vueltas>100){

clearInterval(loop);

numero.innerText="#"+ganador.numero;
nombre.innerText=ganador.nombre;

/* CONFETI */
confetti({
particleCount:200,
spread:160,
origin:{y:0.6}
});

animando=false;
}

},velocidad);

}


/* ðŸ‘‚ ESCUCHAR GANADOR */
onSnapshot(
doc(db,"ganador","actual"),
(snap)=>{

if(!snap.exists()) return;

animar(snap.data());

});

</script>

</body>
</html>
