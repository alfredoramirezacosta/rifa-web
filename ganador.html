<!DOCTYPE html>
<html lang="es">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Pantalla Ganador</title>

<style>

body{
margin:0;
background:black;
color:white;
height:100vh;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
font-family:Arial;
overflow:hidden;
}

#slot{
font-size:100px;
padding:40px 80px;
background:#111;
border-radius:20px;
box-shadow:0 0 50px orange;
}

#resultado{
margin-top:40px;
font-size:40px;
opacity:0;
transition:.5s;
text-align:center;
}

</style>

</head>

<body>

<div id="slot">üé∞</div>

<div id="resultado"></div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script type="module">

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import {
getFirestore,
doc,
onSnapshot,
collection,
getDocs
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";


/* üî• FIREBASE */
const firebaseConfig={
apiKey:"AIzaSyCqVZwBX96EHfl3k__iqyc7rF1MZmSVpRI",
authDomain:"rifa-web-2b2f3.firebaseapp.com",
projectId:"rifa-web-2b2f3",
storageBucket:"rifa-web-2b2f3.firebasestorage.app",
messagingSenderId:"440243321091",
appId:"1:440243321091:web:3a6a0a27e4e418cf6b9136"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

const slot=document.getElementById("slot");
const resultado=document.getElementById("resultado");

let animando=false;


/* üé∞ ANIMACION REAL */
async function iniciarAnimacion(ganador){

if(animando) return;
animando=true;

resultado.style.opacity=0;

const snap=await getDocs(collection(db,"participantes"));

let numeros=[];
snap.forEach(d=>{
numeros.push(d.data().numero);
});

let velocidad=40;
let ciclos=0;

const intervalo=setInterval(()=>{

slot.innerText =
"#"+numeros[Math.floor(Math.random()*numeros.length)];

ciclos++;
velocidad+=5;

if(ciclos>120){

clearInterval(intervalo);

slot.innerText="#"+ganador.numero;

resultado.innerHTML=
`üèÜ GANADOR<br>
<b>${ganador.nombre}</b><br>
N√∫mero #${ganador.numero}`;

resultado.style.opacity=1;

/* üéâ CONFETI */
confetti({
particleCount:250,
spread:180,
origin:{y:0.6}
});

animando=false;
}

},velocidad);

}


/* üëÇ ESCUCHAR CAMBIO REAL */
onSnapshot(
doc(db,"ganador","actual"),
(snapshot)=>{

if(!snapshot.exists()) return;

const ganador=snapshot.data();

console.log("GANADOR DETECTADO:",ganador);

iniciarAnimacion(ganador);

});

</script>

</body>
</html>
